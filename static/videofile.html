<!DOCTYPE html>
<html>
<head>
  <title>Load video frames</title>
  <style>
    #content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
      grid-gap: 1rem;
    }
    #content canvas {
      height: 10rem;
      width: 100%;
      object-fit: contain;
    }
  </style>
</head>

<body>
  <input id="selectfile" type="file" accept="video/*">
  <div id="content">
  </div>

  <script type="module">
    async function getVideoTrack(file) {
      const video = document.createElement("video");
      video.src = URL.createObjectURL(file);
      await video.play();
      const [track] = video.captureStream().getVideoTracks();
      video.onended = (evt) => track.stop();
      return track;
    }

    selectfile.onchange = async function () {
      content.replaceChildren();
      const track = await getVideoTrack(selectfile.files[0]);
      const processor = new MediaStreamTrackProcessor(track);
      const reader = processor.readable.getReader();

      async function readChunk() {
          const {done, value} = await reader.read();
          if (!done) {
              const canvas = document.createElement("canvas");
              canvas.width = value.displayWidth;
              canvas.height = value.displayHeight;
              canvas.getContext('2d').drawImage(value, 0, 0);
              value.close();

              content.appendChild(canvas);
              await readChunk();
          }
      }

      await readChunk();
    }
  </script>

</html>

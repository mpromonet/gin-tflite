<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tflite</title>
</head>

<body>
  <div id="container">
  </div>
</body>
<script>
  function onImageLoaded(output, image, url) {
    output.width = image.width;
    output.height = image.height;

    var context = output.getContext('2d');
    context.drawImage(image, 0, 0);
    context.strokeStyle = 'rgb(0,255,0)'
    context.fillStyle = 'rgb(0,255,0)'
    context.lineWidth = 2;
    context.font = '20px serif';

    var dataurl = output.toDataURL("image/jpeg");
    fetch(dataurl)
    .then(r => r.blob())
    .then(blob => {
      fetch(url, {
        method: 'POST',
        body: blob
      })
      .then(r => r.json())
      .then(data => {
        data.forEach(item => {
            context.fillText(item.ClassName, item.Box.Min.X, item.Box.Min.Y);
            context.rect(item.Box.Min.X, item.Box.Min.Y, (item.Box.Max.X - item.Box.Min.X), (item.Box.Max.Y -item.Box.Min.Y))
            context.stroke()
        })
      })      
    })
  }

  function loadFile(output, event, modelname) {
    var filename = event.target.files[0]
    var reader = new FileReader();
    reader.onload = () => {
      var img = new Image();
      img.src = reader.result;
      img.onload = () => onImageLoaded(output, img, '/runmodel?model=' + modelname)
    }
    reader.readAsDataURL(filename);
  }

  var m = "tflite"
  var div = document.createElement("div")
  var output = document.createElement("canvas")
  output.id = "output" + m
  output.width = 0
  output.height = 0
  div.appendChild(output)
  div.appendChild(document.createElement("br"))
  var input = document.createElement("input")
  input.type = "file"
  input.accept = "image/*"
  input.onchange = function (event) { loadFile(output, event, m) }
  div.appendChild(input)
  document.getElementById("container").appendChild(div)
</script>

</html>
